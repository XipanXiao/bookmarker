<html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="style.css"></link>
    <meta charset="utf-8">
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id"
        content="86770031009-j8bvlfegk1iiaus88rqll987oadmiuk5.apps.googleusercontent.com">
    <title>大藏经通读进度</title>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script type="text/javascript">
      function onSignIn(googleUser) {
        var profile = googleUser.getBasicProfile();
        var input = document.querySelector('#user-id');
        input.value = profile.getId();
        if ("createEvent" in document) {
          var evt = document.createEvent("HTMLEvents");
          evt.initEvent("change", false, true);
          input.dispatchEvent(evt);
        } else {
          input.fireEvent("onchange");
        }
      }
    </script>
  </head>
  <body>
    <select ng-options="sources[id].name for id in sourceIds"
        ng-model="source.id" class="sutra-sources" ng-change="sourceChanged()">
    </select>
    <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark">
    </div>
    <h1 class="center-align">深入经藏，智慧如海</h1>
    <input ng-show="false" type="text" ng-model="userId" id="user-id">
    <div class="center-align">
      进度：已完成{{progresses.length}}部，共{{total}}部
      <span ng-if="!userId">(点右上角按钮登录可保存书签和进度)</span>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar" style="width: {{progresses.length*100.0/total}}%">
      </div>
    </div>
    <div class="padded-element">
      <input placeholder="输入名字查找" ng-model="nameFilter">
      <input type="radio" name="finished" ng-model="selectedState.name" value="全部">
      <input type="radio" name="finished" ng-model="selectedState.name" value="已完成">
      <input type="radio" name="finished" ng-model="selectedState.name" value="未完成">
    </div>
    <div class="book-container" ng-class="{'logedIn': !!userId}">
      <div class="book" ng-repeat="book in books | filter: {name: nameFilter, finished: finishedStates[selectedState.name]}"
          ng-class="{'finished': book.finished}">
        <div class="book-name center-align" ng-click="open(book)">
          {{book.name}}
        </div>
        <div class="serial center-align" ng-click="toggle(book)"
            title="{{book.finished ? '取消标记' : '标记完成'}}">
          <div class="center-align">
            {{book.volume | serial}}{{book.sub ? '-' + book.sub : ''}}
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="index.js?tag=201707120800"></script>
  </body>
</html>
